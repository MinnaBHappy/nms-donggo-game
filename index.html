<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donggo Game - Close the Donggo!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .game-container {
            text-align: center;
            padding: 20px;
        }

        h1 {
            color: #fff;
            text-shadow: 3px 3px 0px #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #ffd700;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        #gameCanvas {
            border: 5px solid #333;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            cursor: none;
        }

        .menu {
            background: rgba(255,255,255,0.95);
            padding: 30px 50px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .menu h2 {
            color: #764ba2;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            display: block;
            width: 200px;
            margin: 10px auto;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-family: inherit;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .easy-btn {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .medium-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .hard-btn {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .difficulty-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .game-ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 800px;
            padding: 10px 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px 10px 0 0;
            color: white;
        }

        .lives {
            font-size: 1.5rem;
        }

        .score {
            font-size: 1.3rem;
            color: #ffd700;
        }

        .tools-collected {
            font-size: 1rem;
            color: #98FB98;
        }

        .progress-bar {
            width: 200px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f, #ffd700);
            transition: width 0.3s ease;
        }

        .hidden {
            display: none !important;
        }

        .game-over-screen, .win-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .game-over-screen h2 {
            color: #ff4b2b;
            font-size: 4rem;
            text-shadow: 3px 3px 0px #000;
            animation: shake 0.5s infinite;
        }

        .win-screen h2 {
            color: #ffd700;
            font-size: 4rem;
            text-shadow: 3px 3px 0px #000;
            animation: bounce 0.5s infinite;
        }

        .final-score {
            color: white;
            font-size: 2rem;
            margin: 20px 0;
        }

        .restart-btn {
            padding: 20px 40px;
            font-size: 1.5rem;
            font-family: inherit;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .restart-btn:hover {
            transform: scale(1.1);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .emoji-animation {
            font-size: 5rem;
            animation: spin 1s infinite linear;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .instructions {
            color: #ddd;
            margin-top: 15px;
            font-size: 0.9rem;
            max-width: 350px;
        }

        .controls-info {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 10px;
            color: #fff;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üçë Donggo Game üçë</h1>
        <p class="subtitle">Close the Donggo and save the day!</p>

        <!-- Menu Screen -->
        <div id="menuScreen" class="menu">
            <h2>Choose Difficulty</h2>
            <button class="difficulty-btn easy-btn" onclick="startGame('easy')">üòä Easy</button>
            <button class="difficulty-btn medium-btn" onclick="startGame('medium')">üòÖ Intermediate</button>
            <button class="difficulty-btn hard-btn" onclick="startGame('hard')">üò∞ Hard</button>
            <p class="instructions">
                <strong>How to Play:</strong><br>
                üèÉ Move left/right to avoid dirty objects<br>
                üîß Collect closing tools (stapler, needle, glue)<br>
                üéØ Collect enough tools to close the donggo!<br>
                ‚ù§Ô∏è You have 3 lives - don't get hit!
            </p>
            <div class="controls-info">
                <strong>Controls:</strong> ‚Üê ‚Üí Arrow Keys or A/D to move
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="game-ui">
                <div class="lives">‚ù§Ô∏è <span id="livesCount">3</span></div>
                <div class="score">Score: <span id="scoreCount">0</span></div>
                <div class="tools-collected">
                    Tools: <span id="toolsCount">0</span>/5
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            <canvas id="gameCanvas" width="800" height="500"></canvas>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="game-over-screen hidden">
            <div class="emoji-animation">üò≠</div>
            <h2>GAME OVER!</h2>
            <p class="final-score">Final Score: <span id="finalScore">0</span></p>
            <p style="color: #aaa; font-size: 1.2rem;">The donggo won this time...</p>
            <button class="restart-btn" onclick="showMenu()">üîÑ Try Again</button>
        </div>

        <!-- Win Screen -->
        <div id="winScreen" class="win-screen hidden">
            <div class="emoji-animation">üéâ</div>
            <h2>YOU WIN!</h2>
            <p class="final-score">Final Score: <span id="winScore">0</span></p>
            <p style="color: #98FB98; font-size: 1.2rem;">The donggo is closed! You're a hero! ü¶∏</p>
            <div style="font-size: 3rem; margin: 20px;">
                <span id="playerCelebrate">üòÑ</span>
                <span style="margin: 0 30px;">VS</span>
                <span id="donggoCry">üò¢</span>
            </div>
            <button class="restart-btn" onclick="showMenu()">üéÆ Play Again</button>
        </div>
    </div>

    <script>
        // Game variables
        let canvas, ctx;
        let gameLoop;
        let difficulty = 'easy';
        let score = 0;
        let lives = 3;
        let toolsCollected = 0;
        let toolsNeeded = 5;
        let gameRunning = false;
        let gameStartTime;
        let objectsAvoided = 0;

        // Difficulty settings
        const difficultySettings = {
            easy: { 
                dropSpeed: 3, 
                spawnRate: 60, 
                playerSpeed: 8,
                toolChance: 0.25,
                scoreMultiplier: 1
            },
            medium: { 
                dropSpeed: 5, 
                spawnRate: 40, 
                playerSpeed: 7,
                toolChance: 0.2,
                scoreMultiplier: 1.5
            },
            hard: { 
                dropSpeed: 7, 
                spawnRate: 25, 
                playerSpeed: 6,
                toolChance: 0.15,
                scoreMultiplier: 2
            }
        };

        // Game objects
        let player = {
            x: 400,
            y: 450,
            width: 50,
            height: 50,
            speed: 8,
            isHit: false,
            hitTimer: 0
        };

        let donggo = {
            x: 400,
            y: 50,
            width: 100,
            height: 80,
            isClosed: false,
            closeProgress: 0,
            crying: false
        };

        let fallingObjects = [];
        let particles = [];
        let frameCount = 0;

        // Dirty objects that fall from donggo
        const dirtyObjects = ['üí©', 'ü™∞', 'ü¶†', 'üóëÔ∏è', 'üßª', 'üí®', 'ü™≥', 'üêõ'];
        
        // Closing tools that can be collected
        const closingTools = ['üìé', 'üß∑', 'ü™°', 'üß¥', 'üîß', 'ü™õ'];

        // Keyboard state
        const keys = {
            left: false,
            right: false
        };

        // Initialize game
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
        }

        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
                keys.left = true;
            }
            if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
                keys.right = true;
            }
        }

        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
                keys.left = false;
            }
            if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
                keys.right = false;
            }
        }

        function startGame(diff) {
            difficulty = diff;
            const settings = difficultySettings[difficulty];
            
            // Reset game state
            score = 0;
            lives = 3;
            toolsCollected = 0;
            objectsAvoided = 0;
            fallingObjects = [];
            particles = [];
            frameCount = 0;
            gameStartTime = Date.now();
            
            // Reset player
            player.x = 375;
            player.y = 430;
            player.speed = settings.playerSpeed;
            player.isHit = false;
            player.hitTimer = 0;
            
            // Reset donggo
            donggo.isClosed = false;
            donggo.closeProgress = 0;
            donggo.crying = false;
            
            // Update UI
            updateUI();
            
            // Show game screen
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('winScreen').classList.add('hidden');
            
            gameRunning = true;
            gameLoop = requestAnimationFrame(update);
        }

        function showMenu() {
            gameRunning = false;
            if (gameLoop) {
                cancelAnimationFrame(gameLoop);
            }
            document.getElementById('menuScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('winScreen').classList.add('hidden');
        }

        function update() {
            if (!gameRunning) return;
            
            frameCount++;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            drawBackground();
            
            // Update and draw donggo
            updateDonggo();
            drawDonggo();
            
            // Spawn falling objects
            spawnObjects();
            
            // Update and draw falling objects
            updateFallingObjects();
            
            // Update player
            updatePlayer();
            drawPlayer();
            
            // Update particles
            updateParticles();
            
            // Check win condition
            if (toolsCollected >= toolsNeeded) {
                winGame();
                return;
            }
            
            // Check game over
            if (lives <= 0) {
                gameOver();
                return;
            }
            
            gameLoop = requestAnimationFrame(update);
        }

        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.7, '#98FB98');
            gradient.addColorStop(1, '#90EE90');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ground
            ctx.fillStyle = '#654321';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
            
            // Grass
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, canvas.height - 25, canvas.width, 10);
            
            // Decorative clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            drawCloud(100, 80, 40);
            drawCloud(600, 100, 35);
            drawCloud(350, 60, 30);
        }

        function drawCloud(x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y - size * 0.3, size * 0.7, 0, Math.PI * 2);
            ctx.arc(x + size * 1.5, y, size * 0.8, 0, Math.PI * 2);
            ctx.fill();
        }

        function updateDonggo() {
            // Donggo wiggles
            donggo.x = 350 + Math.sin(frameCount * 0.05) * 50;
            
            // Close animation progress
            if (toolsCollected > 0) {
                donggo.closeProgress = (toolsCollected / toolsNeeded) * 100;
            }
        }

        function drawDonggo() {
            const x = donggo.x;
            const y = donggo.y;
            
            ctx.save();
            ctx.translate(x + donggo.width / 2, y + donggo.height / 2);
            
            // Slight rotation for character
            ctx.rotate(Math.sin(frameCount * 0.1) * 0.1);
            
            // Draw the donggo (peach/butt emoji style)
            ctx.font = '80px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if (donggo.closeProgress >= 100) {
                // Closed donggo with bandages
                ctx.fillText('ü©π', 0, 0);
            } else if (donggo.closeProgress > 50) {
                // Partially closed
                ctx.fillText('üçë', 0, 0);
                ctx.font = '30px Arial';
                ctx.fillText('üìé', 20, -10);
            } else {
                // Open donggo dropping stuff
                ctx.fillText('üçë', 0, 0);
                
                // Draw "open" indicator
                if (frameCount % 20 < 10) {
                    ctx.font = '20px Arial';
                    ctx.fillText('üí®', 0, 30);
                }
            }
            
            // Draw crying face if game won
            if (donggo.crying) {
                ctx.font = '30px Arial';
                ctx.fillText('üò≠', 0, -50);
            }
            
            ctx.restore();
            
            // Draw owner next to donggo
            ctx.font = '40px Arial';
            ctx.textAlign = 'center';
            if (donggo.crying) {
                ctx.fillText('üò≠', donggo.x - 50, donggo.y + 20);
            } else {
                ctx.fillText('üòà', donggo.x - 50, donggo.y + 20);
            }
        }

        function spawnObjects() {
            const settings = difficultySettings[difficulty];
            
            if (frameCount % settings.spawnRate === 0) {
                const isTool = Math.random() < settings.toolChance;
                
                const obj = {
                    x: donggo.x + 30 + Math.random() * 40,
                    y: donggo.y + donggo.height,
                    speed: settings.dropSpeed + Math.random() * 2,
                    isTool: isTool,
                    emoji: isTool ? 
                        closingTools[Math.floor(Math.random() * closingTools.length)] :
                        dirtyObjects[Math.floor(Math.random() * dirtyObjects.length)],
                    rotation: 0,
                    rotationSpeed: (Math.random() - 0.5) * 0.2,
                    collected: false
                };
                
                fallingObjects.push(obj);
            }
        }

        function updateFallingObjects() {
            const settings = difficultySettings[difficulty];
            
            for (let i = fallingObjects.length - 1; i >= 0; i--) {
                const obj = fallingObjects[i];
                
                obj.y += obj.speed;
                obj.rotation += obj.rotationSpeed;
                
                // Check collision with player
                if (!obj.collected && checkCollision(obj, player)) {
                    if (obj.isTool) {
                        // Collect tool
                        toolsCollected++;
                        score += Math.floor(100 * settings.scoreMultiplier);
                        obj.collected = true;
                        createParticles(obj.x, obj.y, '‚ú®', 5);
                        playSound('collect');
                    } else {
                        // Hit by dirty object
                        if (!player.isHit) {
                            lives--;
                            player.isHit = true;
                            player.hitTimer = 60;
                            createParticles(player.x, player.y, 'üí•', 8);
                            playSound('hit');
                        }
                    }
                    fallingObjects.splice(i, 1);
                    updateUI();
                    continue;
                }
                
                // Remove if off screen and count as avoided
                if (obj.y > canvas.height) {
                    if (!obj.isTool && !obj.collected) {
                        objectsAvoided++;
                        score += Math.floor(10 * settings.scoreMultiplier);
                        updateUI();
                    }
                    fallingObjects.splice(i, 1);
                    continue;
                }
                
                // Draw object
                drawFallingObject(obj);
            }
        }

        function drawFallingObject(obj) {
            ctx.save();
            ctx.translate(obj.x, obj.y);
            ctx.rotate(obj.rotation);
            
            ctx.font = '40px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Glow effect for tools
            if (obj.isTool) {
                ctx.shadowColor = '#ffd700';
                ctx.shadowBlur = 15;
            }
            
            ctx.fillText(obj.emoji, 0, 0);
            ctx.restore();
        }

        function checkCollision(obj, player) {
            const objSize = 30;
            const playerSize = 40;
            
            return obj.x < player.x + playerSize &&
                   obj.x + objSize > player.x &&
                   obj.y < player.y + playerSize &&
                   obj.y + objSize > player.y;
        }

        function updatePlayer() {
            // Handle hit animation
            if (player.isHit) {
                player.hitTimer--;
                if (player.hitTimer <= 0) {
                    player.isHit = false;
                }
            }
            
            // Movement
            if (keys.left && player.x > 10) {
                player.x -= player.speed;
            }
            if (keys.right && player.x < canvas.width - player.width - 10) {
                player.x += player.speed;
            }
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x + player.width / 2, player.y + player.height / 2);
            
            // Flash when hit
            if (player.isHit && Math.floor(player.hitTimer / 5) % 2 === 0) {
                ctx.globalAlpha = 0.5;
            }
            
            // Draw player character
            ctx.font = '50px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            if (player.isHit) {
                ctx.fillText('üòµ', 0, 0);
            } else {
                // Running animation
                const runFrame = Math.floor(frameCount / 10) % 2;
                ctx.fillText(runFrame === 0 ? 'üèÉ' : 'üèÉ‚Äç‚ôÇÔ∏è', 0, 0);
            }
            
            ctx.restore();
        }

        function createParticles(x, y, emoji, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8 - 3,
                    life: 30,
                    emoji: emoji
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.3; // Gravity
                p.life--;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                    continue;
                }
                
                // Draw particle
                ctx.save();
                ctx.globalAlpha = p.life / 30;
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(p.emoji, p.x, p.y);
                ctx.restore();
            }
        }

        function updateUI() {
            document.getElementById('livesCount').textContent = lives;
            document.getElementById('scoreCount').textContent = score;
            document.getElementById('toolsCount').textContent = toolsCollected;
            document.getElementById('progressFill').style.width = `${(toolsCollected / toolsNeeded) * 100}%`;
        }

        function calculateFinalScore() {
            const settings = difficultySettings[difficulty];
            const timeTaken = (Date.now() - gameStartTime) / 1000; // seconds
            
            // Base score from gameplay
            let finalScore = score;
            
            // Speed bonus (faster = more points)
            const speedBonus = Math.max(0, Math.floor((300 - timeTaken) * 10 * settings.scoreMultiplier));
            finalScore += speedBonus;
            
            // Lives bonus
            finalScore += lives * 500 * settings.scoreMultiplier;
            
            // Objects avoided bonus
            finalScore += objectsAvoided * 5 * settings.scoreMultiplier;
            
            return Math.floor(finalScore);
        }

        function winGame() {
            gameRunning = false;
            donggo.crying = true;
            
            const finalScore = calculateFinalScore();
            
            document.getElementById('winScore').textContent = finalScore;
            document.getElementById('winScreen').classList.remove('hidden');
            
            // Celebration animation
            animateCelebration();
        }

        function animateCelebration() {
            const playerEmoji = document.getElementById('playerCelebrate');
            const donggoEmoji = document.getElementById('donggoCry');
            
            const celebrateEmojis = ['üòÑ', 'ü•≥', 'üòÜ', 'ü§©', 'üòä'];
            const cryEmojis = ['üò¢', 'üò≠', 'üòø', 'ü•∫'];
            
            let frame = 0;
            const celebrateInterval = setInterval(() => {
                playerEmoji.textContent = celebrateEmojis[frame % celebrateEmojis.length];
                donggoEmoji.textContent = cryEmojis[frame % cryEmojis.length];
                
                // Jump effect
                playerEmoji.style.transform = frame % 2 === 0 ? 'translateY(-20px)' : 'translateY(0)';
                
                frame++;
                
                if (!document.getElementById('winScreen').classList.contains('hidden')) {
                    // Keep animating
                } else {
                    clearInterval(celebrateInterval);
                }
            }, 300);
        }

        function gameOver() {
            gameRunning = false;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function playSound(type) {
            // Sound effects using Web Audio API (optional - can be enhanced)
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'collect') {
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                } else if (type === 'hit') {
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.1;
                }
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Audio not supported
            }
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
